{"ast":null,"code":"import jwt_decode from 'jwt-decode';\nimport { LocalStorageConfig } from '../config/local.storage.config';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./my.local.storage.service\";\nimport * as i2 from \"ngx-permissions\";\nexport class MyRoleService {\n  constructor(localStorageService, ngxRoleService) {\n    this.localStorageService = localStorageService;\n    this.ngxRoleService = ngxRoleService;\n  }\n  getRolesFromJwt() {\n    const token = this.localStorageService.get(LocalStorageConfig.JWT);\n    if (token) {\n      const decodedToken = jwt_decode(token);\n      let roles = decodedToken['role'];\n      if (!Array.isArray(roles)) {\n        roles = [roles];\n      }\n      return roles;\n    } else {\n      return [];\n    }\n  }\n  hasRole(role) {\n    console.log(this.ngxRoleService.getRole(role));\n    return true;\n  }\n  setRoles() {\n    this.getRolesFromJwt().forEach(el => this.ngxRoleService.addRole(el, ['ac']));\n  }\n  isAuthenticated() {\n    return Object.keys(this.ngxRoleService.getRoles()).length !== 0;\n    ;\n  }\n  flushRoles() {\n    this.ngxRoleService.flushRoles();\n  }\n}\nMyRoleService.ɵfac = function MyRoleService_Factory(t) {\n  return new (t || MyRoleService)(i0.ɵɵinject(i1.MyLocalStorageService), i0.ɵɵinject(i2.NgxRolesService));\n};\nMyRoleService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: MyRoleService,\n  factory: MyRoleService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"AAEA,OAAOA,UAAU,MAAM,YAAY;AAEnC,SAASC,kBAAkB,QAAQ,gCAAgC;;;;AAOnE,OAAM,MAAOC,aAAa;EAExBC,YAAoBC,mBAA0C,EAC1CC,cAA+B;IAD/B,wBAAmB,GAAnBD,mBAAmB;IACnB,mBAAc,GAAdC,cAAc;EAAqB;EAE/CC,eAAe;IACrB,MAAMC,KAAK,GAAG,IAAI,CAACH,mBAAmB,CAACI,GAAG,CAACP,kBAAkB,CAACQ,GAAG,CAAC;IAClE,IAAIF,KAAK,EAAE;MACT,MAAMG,YAAY,GAAQV,UAAU,CAACO,KAAK,CAAC;MAC3C,IAAII,KAAK,GAAGD,YAAY,CAAC,MAAM,CAAC;MAChC,IAAI,CAACE,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,EAAE;QACzBA,KAAK,GAAG,CAACA,KAAK,CAAC;;MAEjB,OAAOA,KAAK;KACb,MAAM;MACL,OAAO,EAAE;;EAEb;EAEAG,OAAO,CAACC,IAAW;IACjBC,OAAO,CAACC,GAAG,CAAC,IAAI,CAACZ,cAAc,CAACa,OAAO,CAACH,IAAI,CAAC,CAAC;IAC9C,OAAO,IAAI;EACb;EAEAI,QAAQ;IACN,IAAI,CAACb,eAAe,EAAE,CAACc,OAAO,CAC5BC,EAAE,IAAI,IAAI,CAAChB,cAAc,CAACiB,OAAO,CAACD,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAC9C;EACH;EAEAE,eAAe;IACb,OAAOC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACpB,cAAc,CAACqB,QAAQ,EAAE,CAAC,CAACC,MAAM,KAAK,CAAC;IAAC;EAClE;EAEAC,UAAU;IACR,IAAI,CAACvB,cAAc,CAACuB,UAAU,EAAE;EAClC;;AApCW1B,aAAa;mBAAbA,aAAa;AAAA;AAAbA,aAAa;SAAbA,aAAa;EAAA2B,SAAb3B,aAAa;EAAA4B,YAFZ;AAAM","names":["jwt_decode","LocalStorageConfig","MyRoleService","constructor","localStorageService","ngxRoleService","getRolesFromJwt","token","get","JWT","decodedToken","roles","Array","isArray","hasRole","role","console","log","getRole","setRoles","forEach","el","addRole","isAuthenticated","Object","keys","getRoles","length","flushRoles","factory","providedIn"],"sourceRoot":"","sources":["D:\\Inforce\\UrlShortener\\UrlShortener\\ClientApp\\src\\app\\services\\role.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { MyLocalStorageService } from './my.local.storage.service';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { NgxRolesService } from 'ngx-permissions';\r\nimport { LocalStorageConfig } from '../config/local.storage.config';\r\nimport { Roles } from '../models/roles';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MyRoleService {\r\n\r\n  constructor(private localStorageService: MyLocalStorageService,\r\n              private ngxRoleService: NgxRolesService) { }\r\n\r\n  private getRolesFromJwt(): string[] {\r\n    const token = this.localStorageService.get(LocalStorageConfig.JWT); \r\n    if (token) {\r\n      const decodedToken: any = jwt_decode(token);\r\n      let roles = decodedToken['role'];\r\n      if (!Array.isArray(roles)) {\r\n        roles = [roles];\r\n      }\r\n      return roles;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  hasRole(role: Roles): boolean {\r\n    console.log(this.ngxRoleService.getRole(role));\r\n    return true;\r\n  }\r\n\r\n  setRoles() {\r\n    this.getRolesFromJwt().forEach(\r\n      el => this.ngxRoleService.addRole(el, ['ac'])\r\n    );\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return Object.keys(this.ngxRoleService.getRoles()).length !== 0;;\r\n  }\r\n\r\n  flushRoles() {\r\n    this.ngxRoleService.flushRoles();\r\n  }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}